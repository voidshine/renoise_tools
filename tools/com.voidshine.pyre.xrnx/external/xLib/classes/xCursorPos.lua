cLib.require(_xlibroot.."xLine")cLib.require(_xlibroot.."xTrack")cLib.require(_xlibroot.."xColumns")cLib.require(_xlibroot.."xPatternPos")cLib.require(_xlibroot.."xPatternSequencer")class'xCursorPos'function xCursorPos:__init(...)local a=cLib.unpack_args(...)if type(a)=="table"and table.is_empty(a)then a={sequence=rns.selected_sequence_index,track=rns.selected_track_index,line=rns.selected_line_index,column=xTrack.get_selected_column_index()}end;self.sequence=a.sequence;self.track=a.track;self.line=a.line;self.column=a.column end;function xCursorPos:resolve()TRACE("xCursorPos:resolve()",self)if self.sequence>#rns.sequencer.pattern_sequence then return nil,"Sequence index is out of bounds"end;if self.line>renoise.Pattern.MAX_NUMBER_OF_LINES then return nil,"Line index is out of bounds"end;local b,c=xPatternSequencer.get_pattern_at_index(self.sequence)if not c then return nil,"Could not resolve pattern"end;local d=rns.tracks[self.track]if not d then return nil,"Could not resolve track"end;local e=b:track(self.track)local f=e:line(self.line)if not f then return nil,"Could not resolve line"end;return c,b,d,e,f end;function xCursorPos:get_column()TRACE("xCursorPos:get_column()")local c,g,d,e,f=self:resolve()if not c then return nil,g end;return xLine.get_column(f,self.column,d)end;function xCursorPos:select()TRACE("xCursorPos:select()")local c,g,d,e,f=self:resolve()if not c then return err end;rns.selected_sequence_index=self.sequence;rns.selected_track_index=self.track;rns.selected_line_index=self.line;xTrack.set_selected_column_index(d,self.column)end;function xCursorPos.handle_key(h)TRACE("xCursorPos:handle_key(key)",h)if h.modifiers==""then local i={["esc"]=function()rns.transport.edit_mode=not rns.transport.edit_mode end,["up"]=function()xPatternPos.jump_to_previous_line()end,["down"]=function()xPatternPos.jump_to_next_line()end,["left"]=function()xColumns.previous_column()end,["right"]=function()xColumns.next_column()end,["tab"]=function()xTrack.jump_to_next_track()end,["f9"]=function()xPatternPos.jump_to_first_quarter_row()end,["f10"]=function()xPatternPos.jump_to_second_quarter_row()end,["f11"]=function()xPatternPos.jump_to_third_quarter_row()end,["f12"]=function()xPatternPos.jump_to_fourth_quarter_row()end,["home"]=function()xPatternPos.jump_to_first_quarter_row()end,["end"]=function()xPatternPos.jump_to_last_line()end,["next"]=function()xPatternPos.jump_to_next_page()end,["prior"]=function()xPatternPos.jump_to_previous_page()end}if i[h.name]then i[h.name]()return true end elseif h.modifiers=="shift"then local i={["tab"]=function()xTrack.jump_to_previous_track()end}if i[h.name]then i[h.name]()return true end end;return false end;function xCursorPos:__tostring()return type(self).."{sequence="..tostring(self.sequence)..", track="..tostring(self.track)..", line="..tostring(self.line)..", column="..tostring(self.column).."}"end