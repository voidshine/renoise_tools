class'xScale'xScale.PENTATONIC_EGYPTIAN="Egyptian Pentatonic"xScale.NEAPOLITAN_MAJOR="Major Neapolitan"xScale.NEAPOLITAN_MINOR="Minor Neapolitan"if renoise.API_VERSION>4 then xScale.PENTATONIC_EGYPTIAN="Pentatonic Egyptian"xScale.NEAPOLITAN_MAJOR="Neapolitan Major"xScale.NEAPOLITAN_MINOR="Neapolitan Minor"end;xScale.KEYS={"C","C#","D","D#","E","F","F#","G","G#","A","A#","B"}xScale.SCALES={{name="None",keys={1,1,1,1,1,1,1,1,1,1,1,1},count=12},{name="Natural Major",keys={1,0,1,0,1,1,0,1,0,1,0,1},count=7},{name="Natural Minor",keys={1,0,1,1,0,1,0,1,1,0,1,0},count=7},{name="Pentatonic Major",keys={1,0,1,0,1,0,0,1,0,1,0,0},count=5},{name="Pentatonic Minor",keys={1,0,0,1,0,1,0,1,0,0,1,0},count=5},{name=xScale.PENTATONIC_EGYPTIAN,keys={1,0,1,0,0,1,0,1,0,0,1,0},count=5},{name="Blues Major",keys={1,0,1,1,1,0,0,1,0,1,0,0},count=6},{name="Blues Minor",keys={1,0,0,1,0,1,1,1,0,0,1,0},count=6},{name="Whole Tone",keys={1,0,1,0,1,0,1,0,1,0,1,0},count=6},{name="Augmented",keys={1,0,0,1,1,0,0,1,1,0,0,1},count=6},{name="Prometheus",keys={1,0,1,0,1,0,1,0,0,1,1,0},count=6},{name="Tritone",keys={1,1,0,0,1,0,1,1,0,0,1,0},count=6},{name="Harmonic Major",keys={1,0,1,0,1,1,0,1,1,0,0,1},count=7},{name="Harmonic Minor",keys={1,0,1,1,0,1,0,1,1,0,0,1},count=7},{name="Melodic Minor",keys={1,0,1,1,0,1,0,1,0,1,0,1},count=7},{name="All Minor",keys={1,0,1,1,0,1,0,1,1,1,1,1},count=9},{name="Dorian",keys={1,0,1,1,0,1,0,1,0,1,1,0},count=7},{name="Phrygian",keys={1,1,0,1,0,1,0,1,1,0,1,0},count=7},{name="Phrygian Dominant",keys={1,1,0,0,1,1,0,1,1,0,1,0},count=7},{name="Lydian",keys={1,0,1,0,1,0,1,1,0,1,0,1},count=7},{name="Lydian Augmented",keys={1,0,1,0,1,0,1,0,1,1,0,1},count=7},{name="Mixolydian",keys={1,0,1,0,1,1,0,1,0,1,1,0},count=7},{name="Locrian",keys={1,1,0,1,0,1,1,0,1,0,1,0},count=7},{name="Locrian Major",keys={1,0,1,0,1,1,1,0,1,0,1,0},count=7},{name="Super Locrian",keys={1,1,0,1,1,0,1,0,1,0,1,0},count=7},{name=xScale.NEAPOLITAN_MAJOR,keys={1,1,0,1,0,1,0,1,0,1,0,1},count=7},{name=xScale.NEAPOLITAN_MINOR,keys={1,1,0,1,0,1,0,1,1,0,0,1},count=7},{name="Romanian Minor",keys={1,0,1,1,0,0,1,1,0,1,1,0},count=7},{name="Spanish Gypsy",keys={1,1,0,0,1,1,0,1,1,0,0,1},count=7},{name="Hungarian Gypsy",keys={1,0,1,1,0,0,1,1,1,0,0,1},count=7},{name="Enigmatic",keys={1,1,0,0,1,0,1,0,1,0,1,1},count=7},{name="Overtone",keys={1,0,1,0,1,0,1,1,0,1,1,0},count=7},{name="Diminished Half",keys={1,1,0,1,1,0,1,1,0,1,1,0},count=8},{name="Diminished Whole",keys={1,0,1,1,0,1,1,0,1,1,0,1},count=8},{name="Spanish Eight-Tone",keys={1,1,0,1,1,1,1,0,1,0,1,0},count=8},{name="Nine-Tone Scale",keys={1,0,1,1,1,0,1,1,1,1,0,1},count=9}}xScale.SCALE_NAMES={}for a,b in ipairs(xScale.SCALES)do table.insert(xScale.SCALE_NAMES,b.name)end;xScale.WHITE_KEYS={0,2,4,5,7,9,11,12,14,16,17,19,21,23,24,26,28,29,31,33,35,36,38,40,41,43,45,47,48,50,52,53,55,57,59,60,62,64,65,67,69,71,72,74,76,77,79,81,83,84,86,88,89,91,93,95,96,98,100,101,103,105,107,108,110,112,113,115,117,119}function xScale.restrict_to_scale(c,d,e)TRACE("xScale.restrict_to_scale(note_value,scale_idx_or_name,scale_key)",c,d,e)if c>119 then return c end;if not e then e=1 end;local f,g=nil,nil;if type(d)=="string"then f=xScale.get_scale_by_name(d)else f=xScale.SCALES[d]end;if not f then LOG("xScale - could not locate scale")return c end;local h=xScale.get_shifted_keys(f,e)local i=c%12;local j=0;while h[i+1]==0 do i=(i-1)%12;j=j+1 end;return c-j end;function xScale.get_shifted_keys(f,i)TRACE("xScale.get_shifted_keys(scale,key)",f,i)assert(type(f)=="table")assert(type(i)=="number")local h=table.rcopy(f.keys)if i>1 then local k=i-1;while k>0 do local l=h[#h]table.insert(h,1,l)table.remove(h,#h)k=k-1 end end;return h end;function xScale.get_scale_by_name(m)TRACE("xScale.get_scale_by_name(name)",m)local g=xScale.get_scale_index_by_name(m)if g then return xScale.SCALES[g]end end;function xScale.get_scale_index_by_name(m)TRACE("xScale.get_scale_index_by_name(name)",m)for n,b in pairs(xScale.SCALES)do if b.name==m then return n end end end;function xScale.get_scales_with_count(o)TRACE("xScale.get_scales_with_count(count)",o)local p={}for n,b in pairs(xScale.SCALES)do if b.count==o then table.insert(p,b)end end;return p end;function xScale.get_selected_scale()TRACE("xScale.get_selected_scale()")local q=rns.selected_instrument;if q then return q.trigger_options.scale_mode end end;function xScale.get_selected_key()TRACE("xScale.get_selected_key()")local q=rns.selected_instrument;if q then return q.trigger_options.scale_key end end